import ApprovalIcon from '@mui/icons-material/Approval';
import { Card, CardContent, Typography } from '@mui/material';
import React, { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import Loader from '../../../components/Loader';
import SearchTable from "../../../components/SearchTableAlt";
import { useSnackbar } from '../../../components/Snackbar';
import useTitle from '../../../hooks/useTitle';
import axiosClient from '../../../utils/AxiosInterceptor';

const AdminViewIndentRequest = () => {

    const pageName = "Approve/Reject Indent Requests"
    useTitle(pageName);

    const [rows, setRows] = useState([]);
    const [isLoading, setIsLoading] = useState(false);
    const { showSnackbar } = useSnackbar();

    useEffect(() => {
        setIsLoading(true);

        axiosClient.get(`${process.env.REACT_APP_INDENT_API_URL}/indent/inbox`)
            .then(response => {

                if (response.data?.result?.length === 0)
                    showSnackbar("No Indent Requests found", "warning");

                let responseData = response.data?.result?.map((value, index) => {
                    let rowData = { ...value, index: index + 1 };

                    return rowData;
                })
                setRows(responseData);
            })
            .catch(error => {
                showSnackbar(error.response.data.message ? error.response.data.message : error.response.message, 'error');
                setRows([]);
            })
            .finally(() => setIsLoading(false));

        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, []);

    const columns = [
        {
            field: "index",
            headerName: "S.No",
            flex: 0.1,
            minWidth: 80,
            headerClassName: "super-app-theme--header",
        },
        {
            field: "requestId",
            headerName: "Request Id",
            flex: 0.3,
            minWidth: 150,
            headerClassName: "super-app-theme--header",
            renderCell: (params) => (
                <Link to="/ar-indent-request-details" state={{ requestId: params.value, empCode: params.row.empCode, employeeName: params.row.employeeName }}>
                    IR{params.value}
                </Link>
            )
        },
        {
            field: "employeeName",
            headerName: "Employee Name",
            flex: 0.5,
            minWidth: 250,
            headerClassName: "super-app-theme--header",
        },
        {
            field: "empCode",
            headerName: "Employee Code",
            flex: 0.5,
            minWidth: 250,
            headerClassName: "super-app-theme--header",
        },
        {
            field: "raisedOn",
            headerName: "Raised On",
            flex: 0.3,
            minWidth: 200,
            headerClassName: "super-app-theme--header",
        },
    ]

    return (
        <>
            {
                isLoading && <Loader />
            }
            <Card >
                <Typography variant='h4' ><ApprovalIcon sx={{ fontSize: "25px", color: '#246cb5' }} />&nbsp;{pageName}</Typography>
                <CardContent>
                    <SearchTable
                        columns={columns}
                        data={rows}
                        isCheckbox={false}
                        isHideDensity={false}
                        isHideExport={true}
                        isHideFilter={false}
                        isHideColumn={false}
                        isHidePaging={false}
                        name="IndentRequestTable"
                        id="IndentRequestTable"
                    />
                </CardContent>
            </Card>
        </>
    )
}

export default AdminViewIndentRequest
